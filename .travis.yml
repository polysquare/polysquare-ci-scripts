language: python
sudo: false
matrix:
  include:
  - os: linux
    python: '2.7'
  - os: linux
    python: '3.5'
  - os: linux
    python: 'pypy'
  - os: linux
    python: 'pypy3'
  - os: osx
    language: generic
    env: PYTHON=python PIP=pip
    osx_image: xcode8
  - os: osx
    language: generic
    env: PYTHON=python3 PIP=pip3
    osx_image: xcode8
addons:
  apt:
    sources:
    - deadsnakes
    packages:
    - python3.4-dev
cache:
  directories:
    - container
install:
 - eval "$(cat $(pwd)/ciscripts/bash/osx-python.sh)"
 # As a special case for this project, we specify our ciscripts
 # directory as -r so that changes from the pull-request are
 # used during the build process.
 - eval "$(curl -LSs --connect-timeout 2 --retry 100 file://$(pwd)/ciscripts/bootstrap.py | python /dev/stdin -d $(pwd)/container -s container-setup.py -r $(pwd) -e bash -p /dev/stdout)"
script:
 - polysquare_run check/python/check.py --coverage-exclude "*/__init__.py" "*/_scripts/*" "tmp*" --lint-exclude "*/sample/*" --no-mdl
after_success:
 - polysquare_run coverage/python/coverage.py
before_cache:
 - polysquare_cleanup
